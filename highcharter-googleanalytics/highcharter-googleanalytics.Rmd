---
title: "Google Analytics & Highcharter"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    social: menu
    source_code: embed
---

```{r setup, include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE)
library("RGA")
library("dplyr")
library("highcharter")
library("tidyr")

options(highcharter.theme = hc_theme_smpl())
# authorize()
gadata <- get_ga("113913503",
                 start.date = "2016-01-01",
                 end.date = "yesterday",
                 dimensions = "ga:date,ga:source",
                 token = readRDS(".ga-token.rds")[[1]])
gadata <- tbl_df(gadata)
```

Row
-----------------------------------------------------------------------

### 

```{r visitsperday}
gadata %>% 
  select(date, users, sessions, pageviews) %>% 
  gather(key, value, -date) %>% 
  count(date, key, wt = value) %>% 
  arrange(date) %>% 
  group_by(name = key) %>% 
  do(data = list.parse3(data.frame(x = datetime_to_timestamp(.$date), y = .$n))) %>% 
  ungroup() %>% 
  mutate(yAxis = seq(nrow(.)) - 1) %>% 
  list.parse3() %>% 
  hc_add_series_list(highchart(), .) %>% 
  hc_yAxis_multiples(create_yaxis(3)) %>% 
  hc_chart(zoomType = "x") %>% 
  hc_xAxis(type = "datetime") %>% 
  hc_tooltip(shared = TRUE)
```
